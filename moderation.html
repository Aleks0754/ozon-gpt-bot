<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Модерация отзывов</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #eee; }
    button { padding: 6px 10px; margin: 0 2px; }
    select { padding: 6px; margin-bottom: 10px; }
  </style>
</head>
<body>
  <h1>Модерация отзывов</h1>

  <label for="status-filter">Фильтр:</label>
  <select id="status-filter">
    <option value="all">Все</option>
    <option value="new">Новые</option>
    <option value="approved">Одобренные</option>
    <option value="rejected">Отклонённые</option>
  </select>

  <div id="content">Загрузка...</div>

  <script>
    function loadReviews() {
      const filter = document.getElementById("status-filter").value;
      fetch(`/api/reviews?status=${filter}`)
        .then(r => r.json())
        .then(data => {
          const rows = data.map(item => `
            <tr>
              <td>${item.text}</td>
              <td>${item.reply}</td>
              <td>
                ${item.status === "new" ? `
                  <form method="post" action="/api/reviews/${item.index}/approve" style="display:inline;">
                    <button type="submit">✅</button>
                  </form>
                  <form method="post" action="/api/reviews/${item.index}/reject" style="display:inline;">
                    <button type="submit">❌</button>
                  </form>
                ` : item.status}
              </td>
            </tr>
          `).join("");

          document.getElementById("content").innerHTML = `
            <table>
              <thead><tr><th>Отзыв</th><th>Ответ</th><th>Действие</th></tr></thead>
              <tbody>${rows}</tbody>
            </table>`;
        });
    }

    document.getElementById("status-filter").addEventListener("change", loadReviews);
    loadReviews();
  </script>
</body>
</html>
